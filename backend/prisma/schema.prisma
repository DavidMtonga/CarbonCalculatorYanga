generator client {
  provider = "prisma-client-js"
  previewFeatures = ["fullTextSearchPostgres"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id           Int            @id @default(autoincrement())
  name         String
  email        String         @unique
  password     String
  organization String?
  province     String?        // Add province field
  role         Role           @default(USER)
  lastLogin    DateTime?
  createdAt    DateTime       @default(now())
  updatedAt    DateTime       @updatedAt
  calculations Calculation[]
  offsets      Offset[]
}

model Calculation {
  id              Int              @id @default(autoincrement())
  userId          Int
  type            CalculationType  @default(COOKING)
  emissions       Float
  carbonOffset    Float            @default(0)

  // Keep only cooking-specific fields
  cookingDuration Float?
  cookingMeals    Int?
  fuelType        String?
  charcoalUsed    Float?

  createdAt       DateTime         @default(now())
  updatedAt       DateTime         @updatedAt

  user            User             @relation(fields: [userId], references: [id])

  // Relations to offsets (baseline and improved)
  offsetsAsBaseline Offset[]       @relation("BaselineCalculation")
  offsetsAsImproved Offset[]       @relation("ImprovedCalculation")

  @@index([userId])
  @@index([type])
  @@index([createdAt])
}

enum Role {
  ADMIN
  USER
}

enum CalculationType {

  COOKING
  
}

// Track explicit offset actions/improvements
model Offset {
  id                     Int          @id @default(autoincrement())
  userId                 Int
  amount                 Float
  baselineCalculationId  Int?
  improvedCalculationId  Int?
  createdAt              DateTime     @default(now())
  updatedAt              DateTime     @updatedAt

  user                   User         @relation(fields: [userId], references: [id])
  baselineCalculation    Calculation? @relation("BaselineCalculation", fields: [baselineCalculationId], references: [id])
  improvedCalculation    Calculation? @relation("ImprovedCalculation", fields: [improvedCalculationId], references: [id])

  @@index([userId])
  @@index([baselineCalculationId])
  @@index([improvedCalculationId])
}